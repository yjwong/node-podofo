version: 0.3.0-{build}
os: Visual Studio 2015
environment:
  matrix:
    - nodejs_version: 8.1.4
      platform: x64
    - nodejs_version: 8.1.4
      platform: x86
    - nodejs_version: 5.10
      platform: x64
    - nodejs_version: 5.10
      platform: x86
    - nodejs_version: 4.4
      platform: x64
    - nodejs_version: 4.4
      platform: x86
  access_token:
    secure: dEViCwlC9QsVdmBzdbybivULfYql2xhNYGD5/qhN3pM1OhCjvmZx1xGLGNg5paSW
  NODE_PRE_GYP_GITHUB_TOKEN: dEViCwlC9QsVdmBzdbybivULfYql2xhNYGD5/qhN3pM1OhCjvmZx1xGLGNg5paSW

cache:
  - '%APPDATA%\npm-cache'
install:
  - ps: Install-Product node $env:nodejs_version $env:platform
  # Download and unpack zlib-1.2.11
  # Seems like zlib was mistakenly named .tar.gz, when it in fact is a tar archive
  - ps: Invoke-WebRequest http://zlib.net/zlib-1.2.11.tar.gz -OutFile .\deps\zlib-1.2.11.tar.gz
  - '"C:\Program Files\7-Zip\7z.exe" x -o.\deps .\deps\zlib-1.2.11.tar.gz'
  - del .\deps\zlib-1.2.11.tar.gz
  # Download and unpack freetype-2.8
  - ps: Invoke-WebRequest http://download.savannah.gnu.org/releases/freetype/freetype-2.8.tar.gz -OutFile .\deps\freetype-2.8.tar.gz
  - '"C:\Program Files\7-Zip\7z.exe" x -o.\deps .\deps\freetype-2.8.tar.gz'
  - '"C:\Program Files\7-Zip\7z.exe" x -o.\deps .\deps\freetype-2.8.tar'
  - del .\deps\freetype-2.8.tar.gz .\deps\freetype-2.8.tar
  # Download and unpack podofo-0.9.3
  # SourceForge redirects unless we use a well-known User-Agent.
  - ps: Invoke-WebRequest http://downloads.sourceforge.net/project/podofo/podofo/0.9.5/podofo-0.9.5.tar.gz -OutFile .\deps\podofo-0.9.5.tar.gz -UserAgent [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome
  - '"C:\Program Files\7-Zip\7z.exe" x -o.\deps .\deps\podofo-0.9.5.tar.gz'
  - '"C:\Program Files\7-Zip\7z.exe" x -o.\deps .\deps\podofo-0.9.5.tar'
  - del .\deps\podofo-0.9.5.tar.gz .\deps\podofo-0.9.5.tar
  # Upgrade npm
  - npm install -g npm
  - npmÂ install -g node-pre-gyp 
  - npm install -g node-pre-gyp-github

build_script:
  - node-pre-gyp build
  - node-pre-gyp package
test: off
artifacts:
  - path: .\build\stage
on_success:
  - node-pre-gyp-github publish --release